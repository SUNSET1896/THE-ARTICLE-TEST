<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章违禁词检测工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .panel h2 {
            color: #3498db;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f1f1;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .text-area {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .text-area:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .results-area {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.6;
            overflow-y: auto;
            background-color: #fdfdfd;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #2ecc71;
            color: white;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        
        .btn-clear {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .forbidden-word {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
            position: relative;
            cursor: pointer;
        }
        
        .forbidden-word:hover::after {
            content: "违禁词";
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 10;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(52, 152, 219, 0.2);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .word-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .word-list h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .word-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .word-tag {
            background-color: #e74c3c;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }
        
        .status.success {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
            display: block;
        }
        
        .status.error {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
            display: block;
        }
        
        .status.info {
            background-color: rgba(52, 152, 219, 0.2);
            color: #2980b9;
            display: block;
        }
        
        .config-panel {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .config-panel h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .config-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .config-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .config-group label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .config-group input[type="text"] {
            padding: 10px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .config-group input[type="text"]:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .config-hint {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 20px;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .footer-text {
            line-height: 1.5;
        }
        
        .follow-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .follow-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .follow-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .follow-btn:active {
            transform: translateY(-1px);
        }
        
        .follow-icon {
            width: 20px;
            height: 20px;
        }
        
        .follow-text {
            font-size: 0.9rem;
            color: #7f8c8d;
            max-width: 500px;
        }
        
        .highlight-options {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .highlight-options label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>文章违禁词检测工具</h1>
            <p class="subtitle">哈基落基于 GitHub 托管的违禁词库 | Attendre et espérer等待，并心怀希望</p>
        </header>
        
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-value" id="wordCount">87,052</div>
                <div class="stat-label">违禁词总数</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="loadedWords">0</div>
                <div class="stat-label">已加载违禁词</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="articleLength">0</div>
                <div class="stat-label">文章字数</div>
            </div>
        </div>
        
        <div class="config-panel">
            <h3>配置设置</h3>
            <div class="config-options">
                <div class="config-group">
                    <label for="wordlistUrl">违禁词库 URL</label>
                    <input type="text" id="wordlistUrl" value="THE_NEW.txt" placeholder="请输入违禁词库文件URL">
                    <p class="config-hint">如果你要使用其他违禁词库，请填写完整路径url</p>
                </div>
                <div class="config-group">
                    <label for="batchSizeInput">加载批处理大小</label>
                    <input type="text" id="batchSizeInput" value="1000" placeholder="批处理大小">
                    <p class="config-hint">较大的批处理大小加载更快但可能阻塞UI，建议值：500-2000</p>
                </div>
                <button id="saveConfigBtn" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L8.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                    </svg>
                    保存配置并重新加载词库
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h2>输入文章</h2>
                <textarea id="articleInput" class="text-area" placeholder="请在此处输入或粘贴需要检测的文章内容..."></textarea>
                
                <div class="controls">
                    <button id="detectBtn" class="btn btn-primary" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                            <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                        </svg>
                        开始检测
                    </button>
                    <button id="clearBtn" class="btn btn-clear">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                        </svg>
                        清空文章
                    </button>
                </div>
                
                <div class="highlight-options">
                    <label>
                        <input type="checkbox" id="highlightToggle" checked> 高亮显示违禁词
                    </label>
                    <label>
                        <input type="checkbox" id="caseSensitive"> 区分大小写
                    </label>
                </div>
            </div>
            
            <div class="panel">
                <h2>检测结果</h2>
                <div id="resultsArea" class="results-area">
                    <div class="loading" id="loadingIndicator">
                        <div class="spinner"></div>
                        <p>正在加载违禁词库，请稍候...</p>
                        <p id="loadingDetail">从配置的URL加载违禁词库</p>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="exportBtn" class="btn btn-secondary" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                        </svg>
                        导出结果
                    </button>
                </div>
                
                <div id="statusMessage" class="status"></div>
                
                <div class="word-list">
                    <h3>检测到的违禁词 (<span id="detectedCount">0</span> 个)</h3>
                    <div id="wordTags" class="word-tags">
                        <!-- 检测到的违禁词将显示在这里 -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <div class="footer-content">
                <div class="footer-text">
                    <p>违禁词库来源: GitHub 仓库 | 如果检测过后还有不过审那就是老奈变脸了 | 奈塔神了</p>
                    <p>© 2025 文章违禁词检测工具 | 注意：本工具仅用于内容安全检测，不存储任何用户数据</p>
                    <p>牢落在整理的时候疑似多次Ciallo～(∠・ω<)⌒★而导致精神失常</p>
                </div>
                
                <div class="follow-section">
                    <p class="follow-text">如果你喜欢，可以关注牢落吗</p>
                    <button id="followBtn" class="follow-btn">
                        <svg class="follow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        关注我
                    </button>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // 全局变量
        let forbiddenWords = new Set();
        let detectedWords = new Set();
        let isCaseSensitive = false;
        let batchSize = 1000; // 批处理大小
        let wordlistUrl = 'THE_NEW.txt'; // 默认词库URL
        
        // DOM元素
        const articleInput = document.getElementById('articleInput');
        const resultsArea = document.getElementById('resultsArea');
        const detectBtn = document.getElementById('detectBtn');
        const clearBtn = document.getElementById('clearBtn');
        const exportBtn = document.getElementById('exportBtn');
        const highlightToggle = document.getElementById('highlightToggle');
        const caseSensitiveCheckbox = document.getElementById('caseSensitive');
        const statusMessage = document.getElementById('statusMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingDetail = document.getElementById('loadingDetail');
        const wordTagsContainer = document.getElementById('wordTags');
        const detectedCountElement = document.getElementById('detectedCount');
        const wordCountElement = document.getElementById('wordCount');
        const loadedWordsElement = document.getElementById('loadedWords');
        const articleLengthElement = document.getElementById('articleLength');
        const wordlistUrlInput = document.getElementById('wordlistUrl');
        const batchSizeInput = document.getElementById('batchSizeInput');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const followBtn = document.getElementById('followBtn');
        
        // 从localStorage加载配置
        function loadConfig() {
            const savedUrl = localStorage.getItem('forbiddenWordsUrl');
            const savedBatchSize = localStorage.getItem('forbiddenWordsBatchSize');
            
            if (savedUrl) {
                wordlistUrl = savedUrl;
                wordlistUrlInput.value = savedUrl;
            }
            
            if (savedBatchSize) {
                batchSize = parseInt(savedBatchSize);
                batchSizeInput.value = savedBatchSize;
            }
        }
        
        // 保存配置到localStorage
        function saveConfig() {
            const url = wordlistUrlInput.value.trim();
            const size = parseInt(batchSizeInput.value.trim());
            
            if (url) {
                localStorage.setItem('forbiddenWordsUrl', url);
                wordlistUrl = url;
            }
            
            if (size && size > 0) {
                localStorage.setItem('forbiddenWordsBatchSize', size);
                batchSize = size;
            }
            
            showStatus('配置已保存，正在重新加载词库...', 'info');
            
            // 清空当前词库并重新加载
            forbiddenWords.clear();
            loadedWordsElement.textContent = '0';
            
            // 重新加载词库
            loadForbiddenWords();
        }
        
        // 更新统计信息
        function updateStats() {
            loadedWordsElement.textContent = forbiddenWords.size.toLocaleString();
            articleLengthElement.textContent = articleInput.value.length.toLocaleString();
        }
        
        // 显示状态消息
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = 'status ' + type;
            
            // 如果是成功消息，5秒后自动消失
            if (type === 'success') {
                setTimeout(() => {
                    statusMessage.className = 'status';
                }, 5000);
            }
        }
        
        // 从配置的URL加载违禁词库
        async function loadForbiddenWords() {
            try {
                showStatus(`正在从 ${wordlistUrl} 加载违禁词库，请稍候...`, 'info');
                loadingDetail.textContent = `正在加载违禁词库: ${wordlistUrl}`;
                loadingIndicator.style.display = 'flex';
                detectBtn.disabled = true;
                exportBtn.disabled = true;
                
                // 从配置的URL加载违禁词库
                const response = await fetch(wordlistUrl);
                
                if (!response.ok) {
                    throw new Error(`加载失败: ${response.status} ${response.statusText}`);
                }
                
                const text = await response.text();
                
                // 按行分割并处理
                const lines = text.split('\n');
                let loadedCount = 0;
                let validWordCount = 0;
                
                // 分批处理以避免阻塞UI
                for (let i = 0; i < lines.length; i += batchSize) {
                    const batch = lines.slice(i, Math.min(i + batchSize, lines.length));
                    
                    batch.forEach(line => {
                        // 清理每行的内容：去除首尾空白字符和逗号
                        const word = line.trim().replace(/,$/, '').trim();
                        if (word && word.length > 0) {
                            forbiddenWords.add(word);
                            validWordCount++;
                        }
                        loadedCount++;
                    });
                    
                    loadedWordsElement.textContent = validWordCount.toLocaleString();
                    loadingDetail.textContent = `已处理 ${loadedCount.toLocaleString()} / ${lines.length.toLocaleString()} 行，有效词数: ${validWordCount.toLocaleString()}`;
                    
                    // 让UI有机会更新
                    if (i % 5000 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 0));
                    }
                }
                
                wordCountElement.textContent = validWordCount.toLocaleString();
                updateStats();
                
                // 隐藏加载指示器
                loadingIndicator.style.display = 'none';
                detectBtn.disabled = false;
                exportBtn.disabled = false;
                
                showStatus(`违禁词库加载完成！共加载 ${validWordCount.toLocaleString()} 个违禁词。`, 'success');
                
            } catch (error) {
                console.error('加载违禁词库时出错:', error);
                loadingDetail.textContent = '加载失败，将使用本地示例词库';
                showStatus(`加载失败: ${error.message}，将使用本地示例词库`, 'error');
                
                // 加载失败时使用示例词库
                loadExampleWords();
            }
        }
        
        // 加载示例词库（备用）
        function loadExampleWords() {
            const exampleWords = [
                "违禁词1", "敏感词", "非法", "违规", "不良信息",
                "反动", "暴力", "色情", "赌博", "毒品",
                "诈骗", "传销", "邪教", "恐怖", "分裂",
                "攻击", "诽谤", "造谣", "泄露", "隐私",
                "侵权", "盗版", "抄袭", "造假", "虚假",
                "误导", "欺诈", "陷阱", "诈骗", "传销"
            ];
            
            exampleWords.forEach(word => {
                forbiddenWords.add(word);
            });
            
            wordCountElement.textContent = exampleWords.length.toLocaleString();
            updateStats();
            
            // 隐藏加载指示器
            loadingIndicator.style.display = 'none';
            detectBtn.disabled = false;
            exportBtn.disabled = false;
            
            showStatus(`使用本地示例词库，共加载 ${exampleWords.length} 个违禁词。`, 'info');
        }
        
        // 构建Trie树以提高搜索效率
        function buildTrie(words) {
            const root = {};
            
            for (const word of words) {
                let node = root;
                for (const char of word) {
                    if (!node[char]) {
                        node[char] = {};
                    }
                    node = node[char];
                }
                node.isEnd = true;
            }
            
            return root;
        }
        
        // 使用Trie树搜索违禁词
        function searchWithTrie(text, trie) {
            const detected = new Set();
            const textLength = text.length;
            
            for (let i = 0; i < textLength; i++) {
                let node = trie;
                let j = i;
                
                while (j < textLength && node[text[j]]) {
                    node = node[text[j]];
                    j++;
                    
                    if (node.isEnd) {
                        const word = text.substring(i, j);
                        detected.add(word);
                    }
                }
            }
            
            return Array.from(detected);
        }
        
        // 检测文章中的违禁词
        function detectForbiddenWords() {
            const article = articleInput.value.trim();
            
            if (!article) {
                showStatus('请输入文章内容', 'error');
                return;
            }
            
            if (forbiddenWords.size === 0) {
                showStatus('词库尚未加载完成，请稍后再试', 'error');
                return;
            }
            
            // 更新文章字数统计
            articleLengthElement.textContent = article.length.toLocaleString();
            
            // 准备搜索文本
            let searchText = article;
            if (!isCaseSensitive) {
                searchText = searchText.toLowerCase();
            }
            
            // 转换违禁词为数组
            const forbiddenWordsArray = Array.from(forbiddenWords);
            
            // 构建Trie树
            const wordTrie = buildTrie(isCaseSensitive ? 
                forbiddenWordsArray : 
                forbiddenWordsArray.map(word => word.toLowerCase())
            );
            
            // 搜索违禁词
            const startTime = performance.now();
            const detected = searchWithTrie(searchText, wordTrie);
            const endTime = performance.now();
            const detectionTime = (endTime - startTime).toFixed(2);
            
            // 存储检测到的违禁词
            detectedWords = new Set(detected);
            
            // 更新UI
            updateResults(article, detected);
            
            // 显示检测结果
            showStatus(`检测完成！发现 ${detected.length} 个违禁词，耗时 ${detectionTime} 毫秒。`, 'success');
        }
        
        // 更新结果区域
        function updateResults(originalText, forbiddenWordsFound) {
            let resultHTML = originalText;
            
            // 更新检测到的违禁词数量
            detectedCountElement.textContent = forbiddenWordsFound.length;
            
            // 清空标签容器
            wordTagsContainer.innerHTML = '';
            
            // 添加违禁词标签
            forbiddenWordsFound.forEach(word => {
                const tag = document.createElement('span');
                tag.className = 'word-tag';
                tag.textContent = word;
                tag.title = `点击复制: ${word}`;
                tag.addEventListener('click', () => {
                    navigator.clipboard.writeText(word).then(() => {
                        showStatus(`已复制违禁词: ${word}`, 'info');
                    });
                });
                wordTagsContainer.appendChild(tag);
            });
            
            // 如果启用高亮，则高亮显示违禁词
            if (highlightToggle.checked && forbiddenWordsFound.length > 0) {
                // 对违禁词按长度排序，优先匹配长词
                const sortedWords = [...forbiddenWordsFound].sort((a, b) => b.length - a.length);
                
                // 创建高亮文本
                let highlightedText = originalText;
                
                sortedWords.forEach(word => {
                    const regex = new RegExp(`(${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'g');
                    highlightedText = highlightedText.replace(regex, '<span class="forbidden-word">$1</span>');
                });
                
                resultHTML = highlightedText;
            }
            
            // 更新结果区域
            resultsArea.innerHTML = resultHTML;
            
            // 如果没有检测到违禁词
            if (forbiddenWordsFound.length === 0) {
                resultsArea.innerHTML = '<p style="color: #27ae60; font-weight: bold;">✅ 恭喜！未检测到任何违禁词。</p>';
            }
        }
        
        // 导出检测结果
        function exportResults() {
            if (detectedWords.size === 0) {
                showStatus('没有检测到违禁词，无法导出', 'error');
                return;
            }
            
            const article = articleInput.value.trim();
            if (!article) {
                showStatus('没有文章内容可导出', 'error');
                return;
            }
            
            const now = new Date();
            const timestamp = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日 ${now.getHours()}时${now.getMinutes()}分`;
            
            let exportText = `文章违禁词检测报告\n`;
            exportText += `生成时间: ${timestamp}\n`;
            exportText += `文章字数: ${article.length}\n`;
            exportText += `检测到违禁词: ${detectedWords.size} 个\n`;
            exportText += `违禁词列表: ${Array.from(detectedWords).join(', ')}\n\n`;
            exportText += `=== 原文内容 ===\n${article}\n\n`;
            exportText += `=== 检测结果 ===\n`;
            
            // 高亮标记违禁词
            let markedText = article;
            const sortedWords = Array.from(detectedWords).sort((a, b) => b.length - a.length);
            
            sortedWords.forEach(word => {
                const regex = new RegExp(`(${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'g');
                markedText = markedText.replace(regex, '【$1】');
            });
            
            exportText += markedText;
            
            // 创建下载链接
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `违禁词检测报告_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('检测结果已导出为文本文件', 'success');
        }
        
        // 清空文章
        function clearArticle() {
            articleInput.value = '';
            resultsArea.innerHTML = '<p style="color: #7f8c8d;">检测结果将显示在这里...</p>';
            wordTagsContainer.innerHTML = '';
            detectedCountElement.textContent = '0';
            articleLengthElement.textContent = '0';
            detectedWords.clear();
            showStatus('文章已清空', 'info');
        }
        
        // 关注按钮点击事件
        function followMe() {
            const followUrl = 'https://app.nieta.art/user?uuid=af15844edc114c5a826f7c426c2db2e4';
            // 在新标签页中打开关注链接
            window.open(followUrl, '_blank');
            showStatus('感谢关注！已为您跳转到关注页面。', 'success');
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            detectBtn.addEventListener('click', detectForbiddenWords);
            clearBtn.addEventListener('click', clearArticle);
            exportBtn.addEventListener('click', exportResults);
            saveConfigBtn.addEventListener('click', saveConfig);
            followBtn.addEventListener('click', followMe);
            
            // 实时更新文章字数
            articleInput.addEventListener('input', function() {
                articleLengthElement.textContent = this.value.length.toLocaleString();
            });
            
            // 高亮切换
            highlightToggle.addEventListener('change', function() {
                if (articleInput.value.trim() && detectedWords.size > 0) {
                    detectForbiddenWords(); // 重新检测以更新高亮
                }
            });
            
            // 大小写敏感切换
            caseSensitiveCheckbox.addEventListener('change', function() {
                isCaseSensitive = this.checked;
                if (articleInput.value.trim() && detectedWords.size > 0) {
                    detectForbiddenWords(); // 重新检测
                }
            });
            
            // 按Ctrl+Enter快捷键检测
            articleInput.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.key === 'Enter') {
                    event.preventDefault();
                    detectForbiddenWords();
                }
            });
            
            // 配置输入框支持Enter键保存
            wordlistUrlInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    saveConfig();
                }
            });
            
            batchSizeInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    saveConfig();
                }
            });
        }
        
        // 初始化应用
        function initApp() {
            // 加载配置
            loadConfig();
            
            // 初始化UI
            updateStats();
            initEventListeners();
            
            // 设置结果区域初始内容
            resultsArea.innerHTML = '<p style="color: #7f8c8d;">检测结果将显示在这里...</p>';
            
            // 开始加载违禁词库
            loadForbiddenWords();
        }
        
        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
